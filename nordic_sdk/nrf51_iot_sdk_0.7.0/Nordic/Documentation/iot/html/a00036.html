<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF51 IoT SDK: Linux commands for 6LoWPAN</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF51 IoT SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00036.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Linux commands for 6LoWPAN </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#iot_sdk_user_guides_linux_commands_cmds">Commands</a><ul><li class="level2"><a href="#iot_sdk_user_guides_linux_debugfs">Mount debugfs filesystem</a></li>
<li class="level2"><a href="#iot_sdk_user_guides_linux_commands_init">Bluetooth 6LoWPAN module initialization</a></li>
<li class="level2"><a href="#iot_sdk_user_guides_linux_commands_connect">Bluetooth 6LoWPAN commands</a></li>
<li class="level2"><a href="#iot_sdk_user_guides_linux_commands_status">HCI commands</a></li>
<li class="level2"><a href="#iot_sdk_user_guides_linux_commands_ifconfig">Linux interfaces</a></li>
<li class="level2"><a href="#iot_sdk_user_guides_linux_commands_ping">Ping devices</a></li>
</ul>
</li>
<li class="level1"><a href="#iot_sdk_user_guides_linux_commands_procedure">Entire procedure</a></li>
</ul>
</div>
<div class="textblock"><p>The IoT SDK implements only the Host role of an IPv6 node. Therefore, each node must connect to a router to be accessible to other notes.</p>
<p>Current versions of the Linux kernel ( &gt; 3.17.0-rc1 ) support 6LoWPAN over L2CAP connection oriented channels, so they can be used as a router. Instead of running the router on a standard computer, you can also use our implementation of the Linux kernel for Raspberry PI. See <a class="el" href="a00039.html">Setting up Raspberry Pi as router</a> for detailed instructions.</p>
<p>Tested Linux kernel version: <b>3.17.0-rc2</b></p>
<h1><a class="anchor" id="iot_sdk_user_guides_linux_commands_cmds"></a>
Commands</h1>
<p>This section lists the most essential Linux commands needed to set up a Linux computer as BLE enabled router. Several of the commands require administrator credentials, so you should log in as a root user by issuing the <code>sudo su</code> command. </p>
<div class="fragment"><div class="line"><span class="preprocessor"># Log in as root user.</span></div>
<div class="line"><span class="preprocessor"></span>sudo su</div>
<div class="line"><span class="preprocessor"># Proceed with caution.</span></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Depending on the Linux variant that you are using, the commands might differ slightly.</dd></dl>
<h2><a class="anchor" id="iot_sdk_user_guides_linux_debugfs"></a>
Mount debugfs filesystem</h2>
<p>By default debugfs file system is not mounted to specific location. To be aligned with most of the Linux distribution, it is recommended to use <b>/sys/kernel/debug</b> location. To make this mount persist it can also be mounted permanently by editing the <em>/etc/fstab</em> file. The following proceedure can be used to mount the <em>debugfs</em>. </p>
<div class="fragment"><div class="line"><span class="preprocessor"># Mount debugfs file system.</span></div>
<div class="line"><span class="preprocessor"></span>mount -t debugfs none /sys/kernel/debug</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Check the contents of the folder.</span></div>
<div class="line"><span class="preprocessor">ls /sys/kernel/debug</span></div>
</div><!-- fragment --><h2><a class="anchor" id="iot_sdk_user_guides_linux_commands_init"></a>
Bluetooth 6LoWPAN module initialization</h2>
<p>Current versions of the Linux kernel provide support for 6LoWPAN in <em>Bluetooth</em> low energy in a stand-alone module. After initializing it, you get access to essential debugfs files.</p>
<p>The Protocol Service Multiplexer number (PSM) can be set in the module. This must be set to the PSM of the Internet Protocol Support Profile (IPSP), which is <b>0x23</b> in hex or <b>35</b> decimal.</p>
<p>To load the 6LoWPAN module: </p>
<div class="fragment"><div class="line">modprobe bluetooth_6lowpan</div>
</div><!-- fragment --><p>To set the correct PSM number: </p>
<div class="fragment"><div class="line">echo 35 &gt; /sys/kernel/debug/bluetooth/6lowpan_psm</div>
</div><!-- fragment --><p>To verify that the module is indeed loaded: </p>
<div class="fragment"><div class="line">lsmod</div>
</div><!-- fragment --><h2><a class="anchor" id="iot_sdk_user_guides_linux_commands_connect"></a>
Bluetooth 6LoWPAN commands</h2>
<p>To use 6LoWPAN communication, both a GAP connection and an L2CAP connection oriented channel must be established. Both can be controled by the debugfs command <code>6lowpan_control</code>. Use this command to connect a device to or disconnect it from the Linux router.</p>
<p>The parameters of this command are:</p>
<ul>
<li>Command: for example "connect" or "disconnect"</li>
<li>Bluetooth Device Address (BDA): for example "00:AA:BB:XX:YY:ZZ"</li>
<li>Type of address: for example 1 (public address) or 2 (random static address)</li>
</ul>
<p>To establish a 6LoWPAN connection: </p>
<div class="fragment"><div class="line">echo <span class="stringliteral">&quot;connect 00:AA:BB:XX:YY:ZZ 1&quot;</span> &gt; /sys/kernel/debug/bluetooth/6lowpan_control</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>On some Linux kernel versions, you might need to repeat this procedure several times to successfully establish a connection.</dd></dl>
<p><a class="anchor" id="iot_sdk_user_guides_linux_commands_disconnect"></a>To disconnect a device from the router: </p>
<div class="fragment"><div class="line">echo <span class="stringliteral">&quot;disconnect 00:AA:BB:XX:YY:ZZ 1&quot;</span> &gt; /sys/kernel/debug/bluetooth/6lowpan_control</div>
</div><!-- fragment --><h2><a class="anchor" id="iot_sdk_user_guides_linux_commands_status"></a>
HCI commands</h2>
<p>HCI commands are used to configure <em>Bluetooth</em> devices. The device name <b>hciX</b> is assigned to the device installed in the system.</p>
<p>To display basic status information about for example interface type, BD address, MTU, and flags (up, running, ...): </p>
<div class="fragment"><div class="line">hciconfig</div>
</div><!-- fragment --><p>To check that the <em>Bluetooth</em> device installed in the system has low energy support: </p>
<div class="fragment"><div class="line">hciconfig hciX lestates </div>
</div><!-- fragment --><p>To reset the HCI device <b>hciX</b> (to ensure that it is cleared before starting): </p>
<div class="fragment"><div class="line">hciconfig hciX reset</div>
</div><!-- fragment --><p><a class="anchor" id="iot_sdk_user_guides_linux_commands_lescan"></a>To discover all advertising devices: </p>
<div class="fragment"><div class="line">hcitool lescan</div>
</div><!-- fragment --><p>Figure 1 displays an example of the output of the <code>hcitool</code> command.</p>
<p><br/>
 </p>
<div class="image">
<img src="hcitoollescan.png" alt="hcitoollescan.png"/>
<div class="caption">
Figure 1. Scan using hcitool.</div></div>
 <h2><a class="anchor" id="iot_sdk_user_guides_linux_commands_ifconfig"></a>
Linux interfaces</h2>
<p>The <code>ifconfig</code> command can be used to display and configure Linux network interfaces that are currently active. After successfully establishing a 6LoWPAN connection, you should see a newly added <b>btX</b> interface in the list.</p>
<p>To display all active network interfaces: </p>
<div class="fragment"><div class="line">ifconfig</div>
</div><!-- fragment --><p>Specifiy an interface name (for example, <b>bt0</b>)to display information about that interface: </p>
<div class="fragment"><div class="line">ifconfig bt0</div>
</div><!-- fragment --><p><br/>
 </p>
<div class="image">
<img src="ifconfig.png" alt="ifconfig.png"/>
<div class="caption">
Figure 2. Display information about the bt0 interface using ifconfig.</div></div>
 <h2><a class="anchor" id="iot_sdk_user_guides_linux_commands_ping"></a>
Ping devices</h2>
<p>Communication between Linux and the device through IPv6 can use different types of protocols. One of these protocols is ICMPv6, which has diagnostic capabilities by sending and receiving echo request and echo response messages.</p>
<p>Use the IPv6 link-local address (see <a class="el" href="a00034.html">Creating IPv6 addresses</a>) to ping a specific device: </p>
<div class="fragment"><div class="line">ping6 -I bt0 fe80::2AA:BBFF:FEXX:YYZZ</div>
</div><!-- fragment --><p><br/>
 </p>
<div class="image">
<img src="ping1.png" alt="ping1.png"/>
<div class="caption">
Figure 3. Ping6 command with unicast address.</div></div>
<p> Send an echo request to an IPv6 multicast all nodes address to discover all devices that are currently attached to router: </p>
<div class="fragment"><div class="line">ping6 -I bt0 ff02::1</div>
</div><!-- fragment --><p>In this case, not only the device will respond, but also the <b>btX</b> interface itself. <br/>
 </p>
<div class="image">
<img src="ping2.png" alt="ping2.png"/>
<div class="caption">
Figure 4. Ping6 command with multicast all node address.</div></div>
<p> The device will only send an echo response message if the application supports it (for example, when using Nordic's stack).</p>
<h1><a class="anchor" id="iot_sdk_user_guides_linux_commands_procedure"></a>
Entire procedure</h1>
<p>The entire procedure how to establish a connection between an nRF51 device and the Linux router is presented below. Some of the commands, like loading the 6LoWPAN module or setting the PSM value, can be called only once per Linux session.</p>
<div class="fragment"><div class="line"><span class="preprocessor"># Log in as root user.</span></div>
<div class="line"><span class="preprocessor"></span>sudo su</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Load 6LoWPAN module.</span></div>
<div class="line"><span class="preprocessor"></span>modprobe bluetooth_6lowpan</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Set PSM channel as 0x23 (35).</span></div>
<div class="line"><span class="preprocessor"></span>echo 35 &gt; /sys/kernel/debug/bluetooth/6lowpan_psm</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Look for available HCI devices.</span></div>
<div class="line"><span class="preprocessor"></span>hciconfig</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Reset HCI device - e.g. hci0 device.</span></div>
<div class="line"><span class="preprocessor"></span>hciconfig hci0 reset</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Read 00:AA:BB:XX:YY:ZZ address of nRF51 device.</span></div>
<div class="line"><span class="preprocessor"></span>hcitool lescan</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Connect to the device.</span></div>
<div class="line"><span class="preprocessor"></span>echo <span class="stringliteral">&quot;connect 00:AA:BB:XX:YY:ZZ 1&quot;</span> &gt; /sys/kernel/debug/bluetooth/6lowpan_control</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Check if you have establish a connection.</span></div>
<div class="line"><span class="preprocessor"></span>ifconfig</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Try to ping device using its link-local address, e.g. on bt0 interface.</span></div>
<div class="line"><span class="preprocessor"></span>ping6 -I bt0 fe80::2AA:BBFF:FEXX:YYZZ</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Disconnect from the device.</span></div>
<div class="line"><span class="preprocessor"></span>echo <span class="stringliteral">&quot;disconnect 00:AA:BB:XX:YY:ZZ&quot;</span> &gt; /sys/kernel/debug/bluetooth/6lowpan_control</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Check if there are active connections left.</span></div>
<div class="line"><span class="preprocessor">ifconfig</span></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="a00043.html">User Guides</a></li>
    <li class="footer">Generated on Wed Dec 17 2014 14:08:22 for nRF51 IoT SDK by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
