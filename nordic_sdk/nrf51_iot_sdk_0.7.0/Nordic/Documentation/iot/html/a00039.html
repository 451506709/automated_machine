<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF51 IoT SDK: Setting up Raspberry Pi as router</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF51 IoT SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00039.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Setting up Raspberry Pi as router </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#iot_sdk_user_guides_raspberry_pi_prereqs">Prerequisites</a></li>
<li class="level1"><a href="#iot_sdk_user_guides_raspberry_pi_connecting">Connecting and obtaining dependencies for your Raspberry Pi</a></li>
<li class="level1"><a href="#iot_sdk_user_guides_raspberry_pi_raspbian">Setting up Raspbian OS</a><ul><li class="level2"><a href="#iot_sdk_user_guides_raspberry_pi_make_a_static_ip">Directly accessing the Raspberry Pi</a></li>
</ul>
</li>
<li class="level1"><a href="#iot_sdk_user_guides_raspberry_pi_raspbian_support">Adding 6LoWPAN support and router capabilities to Raspbian OS</a><ul><li class="level2"><a href="#iot_sdk_user_guides_raspberry_pi_raspbian_kernel">Upgrading the kernel to 3.17 (with 6LoWPAN support)</a></li>
<li class="level2"><a href="#iot_sdk_user_guides_raspberry_pi_raspbian_kernel_router">Adding BLE and router capabilities</a></li>
<li class="level2"><a href="#iot_sdk_user_guides_raspberry_pi_raspbian_kernel_programs">Additional configuration</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>To allow fast startup with 6LoWPAN over <em>Bluetooth</em> low energy, you can set up a Raspberry Pi as Linux boarder router. With this setup, you can test all delivered examples.</p>
<p>The Raspberry Pi must run a version of Raspbian OS that supports 6LoWPAN, the required modules must be installed, and a <em>Bluetooth</em> dongle with <em>Bluetooth</em> low energy support must be connected to the Raspberry Pi.</p>
<p>This user guide explains how to set up Raspbian OS on the Raspberry Pi and add 6LoWPAN support and router capabilities, so that you can use the Raspberry Pi as router.</p>
<h1><a class="anchor" id="iot_sdk_user_guides_raspberry_pi_prereqs"></a>
Prerequisites</h1>
<ul>
<li>Bluez/Radvd/libcap<ul>
<li>bluez_4.99-2_armhf.deb</li>
<li>libcap-ng0_0.6.6-2_armhf.deb</li>
<li>radvd_1.8.5-1_armhf.deb</li>
</ul>
</li>
<li>Kernel &gt;= v3.17<ul>
<li><a href="https://www.nordicsemi.com/eng/Products/Bluetooth-Smart-Bluetooth-low-energy/nRF51822-IoT-SDK/(language)/eng-GB">https://www.nordicsemi.com/eng/Products/Bluetooth-Smart-Bluetooth-low-energy/nRF51822-IoT-SDK/(language)/eng-GB</a></li>
</ul>
</li>
<li>ssh and scp client</li>
</ul>
<p>Note: Save the above downloaded files to the same directory. The kernel must be unzipped prior to transferring them to the raspberry. You should have in total 6 .deb files after unzipping. Let’s call this path <code>/path/to/downloaded/dependencies</code></p>
<dl class="section note"><dt>Note</dt><dd>In order to prepare your SD-card on OS X/Linux/Windows,<ul>
<li>Download the Raspbian image: <a href="http://www.raspberrypi.org/downloads/">http://www.raspberrypi.org/downloads/</a></li>
<li>Follow this guide <a href="http://elinux.org/RPi_Easy_SD_Card_Setup">http://elinux.org/RPi_Easy_SD_Card_Setup</a></li>
</ul>
</dd></dl>
<p>Ways of interfacing:</p>
<ul>
<li>Interfacing with HDMI capable display and keyboard</li>
<li>Interfacing headless (without display and keyboard)</li>
</ul>
<p>If you are not familiar with the raspberry pi, generic information about the board is available on this site: <a href="http://elinux.org/RPi_Hub">http://elinux.org/RPi_Hub</a></p>
<p>Before you start setting up Raspbian OS, ensure that you have an SSH terminal client and the SCP file transfer program installed.</p>
<p>Download the following files:</p>
<ul>
<li>The Debian Wheezy version of the latest Raspbian Operating System image. For example, the version from September 2014 is named <b>2014-09-09-wheezy-raspbian.img</b>. You can download the image from <a href="http://www.raspberrypi.org/downloads/">http://www.raspberrypi.org/downloads/</a>.</li>
<li>A new kernel for Raspbian OS with a precompiled Bluetooth 6LoWPAN kernel module. You can download this kernel from MyPage at <a href="https://www.nordicsemi.com/eng/nordic/mypage">nordicsemi.com</a>.</li>
<li>The required modules for <em>Bluetooth</em> low energy (BlueZ) and RADVD. You can download these modules from the Raspbian apt repository:<ul>
<li><a href="http://mirrordirector.raspbian.org/raspbian/pool/main/b/bluez/bluez_4.99-2_armhf.deb">bluez_4.99-2_armhf.deb</a></li>
<li><a href="http://mirrordirector.raspbian.org/raspbian/pool/main/libc/libcap-ng/libcap-ng0_0.6.6-2_armhf.deb">libcap-ng0_0.6.6-2_armhf.deb</a></li>
<li><a href="http://mirrordirector.raspbian.org/raspbian/pool/main/r/radvd/radvd_1.8.5-1_armhf.deb">radvd_1.8.5-1_armhf.deb</a></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="iot_sdk_user_guides_raspberry_pi_connecting"></a>
Connecting and obtaining dependencies for your Raspberry Pi</h1>
<p>To be able to communicate with your raspberry pi, it’s essential that it’s connected to your network, and that you know the IP address of it. Finding the ip-address of the Raspberry Pi can be done by calling “hostname –I” in the terminal of your Raspberry Pi. If you have issues finding the IP address of your device, please see this page: <a href="http://www.raspberrypi.org/documentation/troubleshooting/hardware/networking/ip-address.md">http://www.raspberrypi.org/documentation/troubleshooting/hardware/networking/ip-address.md</a></p>
<h1><a class="anchor" id="iot_sdk_user_guides_raspberry_pi_raspbian"></a>
Setting up Raspbian OS</h1>
<p>Copy the standard image of Raspbian OS to an SD card. See <a href="http://www.raspberrypi.org/documentation/installation/installing-images/">http://www.raspberrypi.org/documentation/installation/installing-images/</a> for detailed instructions on how to install the image.</p>
<dl class="section note"><dt>Note</dt><dd>Before copying the image, it might be necessary to format the SD card with the FAT file system.</dd></dl>
<p>The following commands demonstrate how to create the SD card on a Linux operating system. These commands assume that the SD card is the <code>/dev/sdb</code> device. See the Raspberry Pi documentation for information about how to create the SD card on other operating systems, or to troubleshoot problems. </p>
<dl class="section warning"><dt>Warning</dt><dd>Make sure that you understand the documentation about how to create the SD card. If you choose a wrong device (for example, <code>/dev/sda</code> instead of <code>/dev/sdb</code>), you might overwrite your current file system!</dd></dl>
<div class="fragment"><div class="line"><span class="preprocessor"># Insert SD card.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># Check all mounted drives.</span></div>
<div class="line"><span class="preprocessor"></span>df -h</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Detach drive.</span></div>
<div class="line"><span class="preprocessor"></span>umount /dev/sdb1</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Copy image into /dev/sdb drive.</span></div>
<div class="line"><span class="preprocessor">dd bs=4M if=2014-09-09-wheezy-raspbian.img of=/dev/sdb</span></div>
</div><!-- fragment --><h2><a class="anchor" id="iot_sdk_user_guides_raspberry_pi_make_a_static_ip"></a>
Directly accessing the Raspberry Pi</h2>
<p>To be able to access the Raspberry Pi without an internet connection and without a router, and without attaching a screen, it must be assigned a static network address. You can then access the Raspberry Pi through this IP address. However, this IP will be used only to get easy access to the dynamic IP address.</p>
<p>To assign a static network address to the Raspberry Pi, edit the network interface configuration file on the system partion. The file is located at <code>/etc/network/interfaces</code> on the Raspian OS SD card. With the SD card mounted on your computer, open the file <code>/media/&lt;path-to-raspbian-system-partition&gt;/etc/network/interfaces</code> in an editor (you need root permissions to edit the file) and add a static network. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> eth0:1</div>
<div class="line">iface eth0:1 inet <span class="keyword">static</span></div>
<div class="line">address 192.168.111.111</div>
<div class="line">netmask 255.255.255.0</div>
</div><!-- fragment --><p>Next, couple the Raspberry Pi and the host directly with a network cable and configure your host machine to use the same static network. For example, assign the host the IP 192.168.111.112 with the same netmask that you used for the Raspberry Pi.</p>
<p>If the host is running on a Linux system, issue the following command, for example: </p>
<div class="fragment"><div class="line">sudo ifconfig eth0 192.168.111.112 netmask 255.255.255.0</div>
</div><!-- fragment --><h1><a class="anchor" id="iot_sdk_user_guides_raspberry_pi_raspbian_support"></a>
Adding 6LoWPAN support and router capabilities to Raspbian OS</h1>
<p>Currently, Raspbian OS does not support 6LoWPAN. You must upgrade the kernel to add 6LoWPAN support. In addition, you need to install several modules that provide <em>Bluetooth</em> low energy and router capabilities</p>
<h2><a class="anchor" id="iot_sdk_user_guides_raspberry_pi_raspbian_kernel"></a>
Upgrading the kernel to 3.17 (with 6LoWPAN support)</h2>
<p>The current Raspbian OS uses the 3.12 Linux kernel, which does not support 6LoWPAN. Therefore you must upgrade the kernel to version 3.17.</p>
<p>Complete the following steps to upgrade the kernel:</p>
<ol type="1">
<li>Insert the SD card into the Raspberry Pi and power it on.</li>
<li>Use SCP to copy the new kernel and the other downloaded packages from the host computer to the Raspberry Pi. For example: <div class="fragment"><div class="line">scp *.deb pi:raspberry@192.168.111.111:~</div>
</div><!-- fragment --></li>
<li>When all files are copied, use SSH to connect to the Raspberry Pi. To do so, use the IP for eth0:1 that you added in the network interface file. For example:<div class="fragment"><div class="line">ssh pi:raspberry@192.168.111.111 </div>
</div><!-- fragment --></li>
<li>In the SSH window, log in as root user on the Raspbery Pi: <div class="fragment"><div class="line"><span class="preprocessor"># Log in as root user.</span></div>
<div class="line"><span class="preprocessor">sudo su</span></div>
</div><!-- fragment --></li>
<li>Install the packages on the Raspbery Pi: <div class="fragment"><div class="line"><span class="preprocessor"># Install the new kernel packages.</span></div>
<div class="line"><span class="preprocessor"></span>dpkg -i linux-headers-*.deb linux-image-*.deb</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Install radvd.</span></div>
<div class="line"><span class="preprocessor"></span>dpkg -i radvd_1.8.5-1_armhf.deb</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Install bluez.</span></div>
<div class="line"><span class="preprocessor"></span>dpkg -i libcap-ng0_0.6.6-2_armhf.deb</div>
<div class="line">dpkg -i bluez_4.99-2_armhf.deb</div>
</div><!-- fragment --> Alternatively, you can install the addional modules with apt-get if the Raspberry Pi is connected to the internet. The kernel, however, must always be upgraded manually. <dl class="section note"><dt>Note</dt><dd>When installing the new kernel, some error messages like "Hmm. There is a symbolic link ..." might appear. You can ignore those messages.</dd></dl>
</li>
<li>Before rebooting the device, you must activate the new kernel:<ol type="a">
<li>List the files in the <code>/boot</code> folder, locate the new kernel image, and open <code>/boot/config.txt</code> for editing. For example: <div class="fragment"><div class="line"><span class="preprocessor"># List files in /boot</span></div>
<div class="line"><span class="preprocessor"></span>pi@raspberrypi ~ $ ls /boot/ | grep vmlinuz</div>
<div class="line">vmlinuz-3.17.4-release+</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Open config.txt for edit.</span></div>
<div class="line"><span class="preprocessor">nano /boot/config.txt</span></div>
</div><!-- fragment --></li>
<li>In <code>/boot/config.txt</code>, add the following content or replace the kernel option with a line like this: <div class="fragment"><div class="line">...</div>
<div class="line"></div>
<div class="line"># Assuming the vmlinuz-3.17.4-release+ is the kernel we want to activate.</div>
<div class="line">kernel=vmlinuz-3.17.4-release+</div>
</div><!-- fragment --></li>
<li>Save <code>/boot/config.txt</code> and exit the editor.</li>
</ol>
</li>
<li>Reboot the Raspberry Pi with the new kernel activated: <div class="fragment"><div class="line"><span class="preprocessor"># Reboot the device.</span></div>
<div class="line"><span class="preprocessor">reboot</span></div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="iot_sdk_user_guides_raspberry_pi_raspbian_kernel_router"></a>
Adding BLE and router capabilities</h2>
<p>To add <em>Bluetooth</em> low energy functionality to Linux, you must install <b>BlueZ</b> - Bluetooth Stack. This module also provides tools like <b>hcitool</b>, <b>hciconfig</b>, and so on.</p>
<p>If you followed the procedure described above, BlueZ is already installed. Otherwise, log in as root user and issue the following command to install it: </p>
<div class="fragment"><div class="line"><span class="preprocessor"># Install BlueZ module.</span></div>
<div class="line"><span class="preprocessor">apt-get install bluez</span></div>
</div><!-- fragment --><p>Having IPv6 connectivity requires distributing the global IPv6 prefix to <em>Bluetooth</em> devices. On Linux, you can use the Router Advertisement Daemon for this purpose. RADVD can periodically or on solicitation send Router Advertisement message.</p>
<p>See <a class="el" href="a00038.html">RADVD for Linux</a> for more information about RADVD and how to configure and run it.</p>
<h2><a class="anchor" id="iot_sdk_user_guides_raspberry_pi_raspbian_kernel_programs"></a>
Additional configuration</h2>
<p>By default, the debugfs file system is not mounted to a specific location in Raspbian OS. To be aligned with most Linux distributions, you should configure Raspbian OS to use <code>/sys/kernel/debug</code> as debugfs location.</p>
<p>The following commands can be used to mount debugfs: </p>
<div class="fragment"><div class="line"><span class="preprocessor"># Log in as root user.</span></div>
<div class="line"><span class="preprocessor"></span>sudo su</div>
<div class="line"><span class="preprocessor"># Proceed with caution.</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"># Mount debugfs file system.</span></div>
<div class="line"><span class="preprocessor"></span>mount -t debugfs none /sys/kernel/debug</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Check the contents of the folder.</span></div>
<div class="line"><span class="preprocessor">ls /sys/kernel/debug</span></div>
</div><!-- fragment --><p>To make this change persistent, mount debugfs permanently by adding it to the <code>/etc/fstab</code> file. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="a00043.html">User Guides</a></li>
    <li class="footer">Generated on Wed Dec 17 2014 14:08:22 for nRF51 IoT SDK by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
